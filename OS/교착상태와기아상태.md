# 교착상태와 기아상태
> 교착상태와 기아상태에 대한 내용에 대해 알아봅시다
<br>

## 교착상태(DeadLock)와 기아상태(Starvation)
### 교착상태(DeadLock)이란
결코 일어나지 않을 사건(이벤트)에 대해서 프로세스가 기다리고 있는 것을 말한다

<br>

### 기아상태(Starvation)이란
무기한 연기로 인해 아무리 기다려도 자신의 차례가 돌아오지 않는 것을 말한다

<br>

- 다중 프로그래밍 시스템에서 프로세스들이 한정된 시스템 자원 차지를 위해 경쟁할 때 발생할 수 있다
- 교착 상태, 기아 상태는 프로세스가 작업을 수행하지 못하고 무한히 대기한다는 공통점이 있다 하지만, 서로 작업을 수행하지 못하는 원인이 다르다

<br>

### 교착 상태가 시스템에 미치는 영향
자원 요구가 뒤엉켜 교착 상태에 빠진 프로세스들은 반납되지 않을 자원을 무한정 기다리게 된다
<br>

이 경우, 작업 진행이 더이상 불가하므로 운영체제가 교착 상태를 해결해야 한다
<br>

만일 운영체제가 교착 상태를 해결하지 못하면, 사용자가 직접 프로그램을 종료하는 방법 등으로 해결해야 한다
- 프로그램을 강제로 종료하여 교착 상태를 해결할 경우, 데이터 손실 위험이 있다

<br>

## 교착상태 발생 조건
교착상태가 발생하려면 다음과 같은 4가지 조건이 모두 만족해야 한다
### 상호 배제(mutual exclusion)
  - 한 번에 한 개의 프로세스만 해당 자원 사용 가능
<br>

### 점유와 대기(hold and wait)
  - 최소한 한 개를 차지하고, 다른 프로세스에 할당된 자원을 얻기 위해 대기
<br>

### 비선점(non-preemption)
  - 자원이 선점될 수 없음(강탈 불가)
  - 자원을 점유하고 있는 프로세스가 자원 사용을 마쳐야 해제
<br>

### 순환 대기(circular wait)
  - 대기 프로세스 집합이 있을 때 P0은 P1이 점유하고 있는 자원을, P1은 P2가 점유하고 있는 자원을 Pn-1은 P0이 점유하고 있는 자원을 대기한다 (점유-대기 사이클 형성)

<br>

## 교착상태 해결 방법
### 교착상태 예방(DeadLock Prevention)
  - 교착상태가 절대 일어나지 않도록 방지한다
  - 명쾌하지만, 자원 활용도가 떨어진다
<br>

### 교착상태 회피(DeadLock Avoidance)
  - 시스템 내 교착상태 가능성은 있으나, 교착 상태를 회피한다
  - 회피 알고리즘 실행으로 시스템 부하가 증가한다
<br>

### 교착상태 탐지와 회복(DeadLock Detection and Recovery)
  - 교착상태 발생을 허용하되, 교착상태를 알아내고 교착상태로부터 벗어나 회복할 수 있게 한다
  - 교착상태 탐지 알고리즘 실행으로 시스템에 부하가 증가한다
  - 교착상태 회복 과정에서, 수행한 작업의 손실이 발생한다

<br>

한 가지의 방법만으로 시스템의 모든 자원 할당 문제를 해결하는 것은 불가능하다
<BR>

예방, 회피, 탐지와 회복 세 가지 방법을 결합하여 자원의 형태에 따라 최적의 접근 방법을 채택해야 한다
  
<br>
  
### 교착 상태 예방(DeadLock Prevention)
교착 상태 필요조건 네 가지 중 한 가지만 방지해도 교착 상태를 예방할 수 있다
<br>
  
교착 상태 예방법은 다음과 같다 
- **점유와 대기** 조건 방지
- **비선점** 조건 방지
- **순환 대기** 조건 방지
  여기서 상호 배제 조건 방지는 제외한다
  - 교착 상태 문제는 한 순간에 프로세스를 1개만 사용할 수 있는 자원이기 때문이다
  - 이 때문에 상호 배제 조건(한 번에 1개의 프로세스만 자원 사용 가능)방지는 사실상 불가능하며 무의미하다
  
<br>
 
#### 점유와 대기 방지 
  ##### 원리
  - 프로세스가 자원을 점유한 채로 다른 자원을 기다리는 일을 없앤다
  - 자원을 점유한 프로세스는 추가 자원을 요청할 수 없도록 한다
  <br>
  
  ##### 방법
  - 각 프로세스는 필요한 모든 자원을 한 번 요청해야 한다
  - 요청한 자원을 모두 할당 받기 전까지는 작업 진행이 불가능하다
  <br>
  
  ##### 변형 방법
  - 자원을 추가 요청하기 전, 점유 중인 모든 자원을 일단 해제한다
  <br>
  
  ##### 단점
  - 많은 자원이 사용되지 않으면서 할당되어 있어야 하므로, 자원 효율이 떨어진다
  - 기아 상태가 발생할 수 있어 대화식 시스템에서 사용이 불가능하다
  - 자주 이용하는 자원이 다른 프로세스에 할당된 경우, 자원을 요청한 프로세스는 모든 자원이 동시에 빌 때까지 무기한 대기해야 할 수 있다
  - 적은 수의 자원을 요청한 프로세스가 유리하므로, 많은 수의 자원을 요청한 프로세스의 대기 시간이 길어질 수 있다
  
  <br>
  
  #### 순환 대기 조건 방지
  ##### 원리
  - 특정 순서대로만 자원을 요청하게 함으로써, 자원 할당 그래프에 사이클이 형성되지 않게 한다
  <br>
  
  ##### 방법
  - 모든 자원에 일련의 순서를 부여하고, 각 프로세스는 이 번호 오름차순으로만 자원을 요청할 수 있다
  <br>
  
  ##### 단점
  - 주어진 순서와 다르게 자원을 필요로 하는 프로세스의 경우, 불 필요한 자원을 미리 할당받게 되므로 자원 낭비가 발생할 수 있다
  - 우선 순위에 따라 자원에 번호를 부여할 경우, 실제로 사용하는 순서를 반영해야 하는 수고가 필요하다
  
  <br>
  
  #### 교착 상태 회피
  ##### 원리
  - 교착 상태가 일어날 가능성을 인정하고, 교착 상태가 일어나지 않도록 회피한다
  <br>
  
  ##### 방법
  - 가용 자원이 있더라도, 요청한 자원을 할당하면 교착 상태가 발생할 위험이 있는 경우 요청을 거절한다
  <br>
  
  교착 상태 회피 방법을 사용할 경우 시스템은 두 가지 상태 중 한 개를 가질 수 있다
  - 안정 상태(stable state)
    - 각 프로세스에 자원을 최대 요구 수까지 할당할 수 있어 교착 상태를 피할 수 있다
  - 불안정 상태(unstable state)
    - 프로세스의 안정 순서가 존재하지 않는 상태이다
  
